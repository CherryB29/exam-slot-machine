<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÎÇ¥ ÏãúÌóòÏ†êÏàòÎäî??</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#0f1724;
      --accent:#ffd166;
      --accent-2:#06d6a0;
      --glass: rgba(255,255,255,0.06);
      --neon: 0 0 14px rgba(255, 209, 102, .35), 0 0 40px rgba(255, 209, 102, .12);
      --size: min(520px, 92vw);
      font-family: Inter, system-ui, -apple-system, 'Noto Sans KR', 'ÎßëÏùÄ Í≥†Îîï', sans-serif;
    }
    html,body{height:100%; overflow-x:hidden; box-sizing:border-box; min-width:0}
    *, *::before, *::after { box-sizing: inherit }
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(6,22,48,.5), transparent),
                  radial-gradient(900px 500px at 90% 80%, rgba(8,44,72,.35), transparent),
                  var(--bg);
      display:flex;align-items:center;justify-content:center;color:#e6eef8;
    }

    .wrap{width:var(--size);max-width:calc(100% - 20px);margin:0 auto;max-width:100vw;padding:0 10px;box-sizing:border-box}

    .machine{
      background: linear-gradient(180deg,#071227 0%, #081826 100%);
      border-radius:20px;padding:22px;box-shadow: 0 20px 60px rgba(2,6,23,.75), inset 0 1px 0 rgba(255,255,255,0.02);
      display:grid;grid-template-columns: 1fr 220px;gap:20px;align-items:start;justify-items:stretch;
      max-width:920px;margin:0 auto;border:1px solid rgba(255,255,255,0.03);backdrop-filter: blur(6px);box-sizing:border-box;max-width:100%;
    }

    .left{
      padding:18px;background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius:12px;box-shadow: var(--neon);width:100%;box-sizing:border-box;display:flex;flex-direction:column;align-items:center;gap:8px;
    }

    .title{font-weight:700;font-size:1.4rem;letter-spacing:-0.5px;margin:0 0 8px 0}
    .subtitle{font-size:.92rem;color:#9fb2d8;margin:0 0 14px 0}

    /* reels */
    .reels{display:flex;gap:14px;justify-content:center;align-items:flex-end;margin:10px 0}
    .reel{
      width:92px;height:156px;background:linear-gradient(180deg,#071827 0,#021421 100%);
      border-radius:12px;padding:12px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.04);
      box-shadow: 0 12px 28px rgba(3,9,27,.6), inset 0 -28px 48px rgba(0,0,0,.5);
      display:flex;align-items:center;justify-content:center;flex-direction:column;
    }
    .reel .window{width:100%;height:80px;overflow:hidden;display:block;position:relative}
    .strip{position:absolute;top:0;left:0;right:0;display:flex;flex-direction:column;align-items:center;gap:10px;}
    .digit{width:70px;height:70px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      display:flex;align-items:center;justify-content:center;font-size:2.2rem;font-weight:900;color:var(--accent-2);text-shadow: 0 4px 18px rgba(0,0,0,.6);
      border:1px solid rgba(255,255,255,0.035);
    }

    /* controls area */
    .controls{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;width:220px;box-sizing:border-box}
    /* when display is placed in left column, make it narrower and centered */
    .left .display, .left-display{width:320px;margin:12px auto}
    .display{
      width:100%;height:120px;background: linear-gradient(180deg,#041826,#05222b);border-radius:14px;padding:16px;box-sizing:border-box;border:1px solid rgba(255,255,255,0.04);
      display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;backdrop-filter: blur(4px);
    }
    .bignum{font-size:3.2rem;font-weight:900;color:var(--accent-2);text-shadow: 0 12px 44px rgba(6,214,160,.12);letter-spacing:-0.6px}
    .hint{color:#9fb2d8;font-size:.86rem}

    /* improved visuals */
    .start-btn{transition:transform .12s ease, box-shadow .18s ease;padding:14px 22px;border-radius:14px;min-width:180px;font-size:1rem}
    .start-btn:hover{transform:translateY(-4px);box-shadow:0 26px 48px rgba(255,177,3,.16)}
    .start-btn:focus{outline:3px solid rgba(255,209,102,0.14);outline-offset:4px}

    /* share button removed */

    .digit{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color:var(--accent-2); box-shadow: inset 0 -10px 28px rgba(0,0,0,0.55);font-variant-numeric: tabular-nums}

    .display{box-shadow: 0 10px 30px rgba(2,6,23,.6)}

    /* special event banner */
    .special-banner{position:relative;margin:6px auto 0;display:inline-block;padding:10px 18px;border-radius:14px;background:linear-gradient(180deg,#ffd166,#ffb703);color:#081220;font-weight:900;box-shadow:0 12px 30px rgba(255,177,3,.08);transform-origin:center center}
    .special-banner.small{background:linear-gradient(180deg,#9ad3ff,#6fb6ff);color:#042233}

    /* score color variants */
    .bignum.score-low{color:#ef476f; text-shadow: 0 12px 34px rgba(239,71,111,0.10)}
    .bignum.score-mid{color:#ffb703; text-shadow: 0 12px 34px rgba(255,183,3,0.08)}
    .bignum.score-high{color:var(--accent-2); text-shadow: 0 12px 44px rgba(6,214,160,.12)}

    /* small control buttons + layout for right column actions */
    .actions{display:flex;align-items:center;gap:12px;justify-content:center;position:relative}
    .left .actions{justify-content:center}
    .btn-small{padding:10px 12px;border-radius:12px;border:none;cursor:pointer;font-size:1rem;box-shadow:0 6px 14px rgba(2,6,23,.45);background:linear-gradient(180deg,#ffffff11,#ffffff06)}
    /* start button: larger, rounded pill-like but matched height with snapshot */
    .start-btn{min-width:200px;height:52px;padding:0 22px;border-radius:20px;font-size:1.02rem;font-weight:900;box-shadow:0 6px 12px rgba(0,0,0,0.28);display:inline-flex;align-items:center;justify-content:center}
    /* snapshot: small square icon to the right of start */
    .snap-btn{width:52px;height:52px;border-radius:12px;background:linear-gradient(180deg,#0b1b26,#061018);color:#dfefff;display:inline-flex;align-items:center;justify-content:center;box-shadow:0 6px 12px rgba(3,9,27,.36);border:1px solid rgba(255,255,255,0.03)}
    .btn-small:active{transform:translateY(2px)}

    @media (prefers-reduced-motion: reduce){
      .start-btn, .stick, .strip { transition: none !important; animation: none !important }
      canvas{display:none}
    }

    .start-btn{background:linear-gradient(180deg,#ffd166,#ffb703);border:none;font-weight:800;cursor:pointer;box-shadow: 0 6px 18px rgba(255,177,3,.12), 0 2px 0 rgba(255,255,255,.06);}
    .start-btn:active{transform:translateY(2px)}

    /* lever removed for cleaner layout */

    /* top lights (hidden for a cleaner layout) */
    .lights{display:none}
    .light{width:12px;height:12px;border-radius:50%;background:#08202a;box-shadow:0 2px 4px rgba(0,0,0,.6)}
    .light.on{background:var(--accent);box-shadow: 0 0 14px rgba(255,209,102,.35)}

    /* confetti canvas overlay: fix to viewport to avoid layout shift/overflow on mobile */
    canvas{position:fixed;inset:0;width:100%;height:100%;pointer-events:none}

    /* footer */
    footer{margin-top:14px;color:#9fb2d8;font-size:.85rem;text-align:center}

    /* responsive tweaks */
    @media (max-width:720px){
      .wrap{width:calc(100vw - 28px); max-width:none}
      .machine{grid-template-columns:1fr; padding:16px; gap:12px; border-radius:14px}
      .left{padding:12px}
      .reels{gap:10px}
      .reel{width:72px;height:120px}
      .digit{width:50px;height:50px;font-size:1.4rem}
      .display{height:96px;padding:12px}
      .bignum{font-size:2rem}
      .controls{width:100%;flex-direction:row;justify-content:space-between;align-items:center;gap:10px}
      .start-btn{min-width:48%;width:58%;padding:12px 10px;font-size:1rem}
      .actions{justify-content:space-between}
      .lever{margin-top:6px}
      footer{font-size:.82rem}
    }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="machine" role="application" aria-label="ÏãúÌóò Ï†êÏàò ÏòàÏ∏°">
      <div class="left">
        <div class="lights" aria-hidden="true">
          <div class="light on"></div>
          <div class="light"></div>
          <div class="light on"></div>
          <div class="light"></div>
          <div class="light on"></div>
        </div>
        <h1 class="title"> ÎÇ¥Ïùº ÎÇ¥ ÏãúÌóòÏ†êÏàòÎäî??</h1>

        <!-- move result display here (centered under title) -->
        <div class="display left-display" aria-live="polite">
          <div class="bignum" id="finalDisplay">‚Äî</div>
          <div class="hint">Î≤ÑÌäºÏùÑ ÎàåÎü¨ Í≤∞Í≥º ÌôïÏù∏</div>
        </div>

        <div class="reels" id="reels">
          <div class="reel" aria-hidden="true">
            <div class="window"><div class="strip" id="strip-0"></div></div>
          </div>
          <div class="reel" aria-hidden="true">
            <div class="window"><div class="strip" id="strip-1"></div></div>
          </div>
          <div class="reel" aria-hidden="true">
            <div class="window"><div class="strip" id="strip-2"></div></div>
          </div>
        </div>

        <!-- actions moved under the reels for cleaner layout -->
        <div class="actions" style="margin-top:18px;">
          <button class="start-btn" id="spinBtn" aria-pressed="false">Í≤∞Í≥º ÌôïÏù∏!</button>
          <button class="btn-small snap-btn" id="snapBtn" title="Ïä§ÎÉÖÏÉ∑ Ï∞çÍ∏∞">üì∏</button>
        </div>
      </div>

      <div class="controls"></div>
    </div>
  </div>

  <canvas id="confetti"></canvas>

  <script>
    // ====== ÏÑ§Ï†ï ======
    const MIN = 1, MAX = 100;
    const reels = [document.getElementById('strip-0'), document.getElementById('strip-1'), document.getElementById('strip-2')];
    const spinBtn = document.getElementById('spinBtn');
    // share feature removed
    const finalDisplay = document.getElementById('finalDisplay');
    const lights = document.querySelectorAll('.light');

    // canvas confetti
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function resizeCanvas(){canvas.width = window.innerWidth; canvas.height = window.innerHeight}
    window.addEventListener('resize', resizeCanvas); resizeCanvas();

    // make lists of digits for reels (0-9) repeated to allow smooth spin
    function makeDigits(){
      // we will center on 3 digits (hundreds,tens,ones) ‚Äî number will be padded to 3 digits
      const digits = [];
      for(let d=0; d<10; d++) digits.push(d);
      return digits;
    }

    const digitPool = makeDigits();

    // Fill strips with many cycles of digits to simulate long spin
    function populateStrips(){
      reels.forEach((r, idx)=>{
        r.innerHTML = '';
        // create many cycles
        for(let cycle=0; cycle<12; cycle++){
          digitPool.forEach(d=>{
            const el = document.createElement('div'); el.className='digit'; el.textContent=d;
            r.appendChild(el);
          });
        }
        // add a final set duplicated to allow smooth scroll
        digitPool.forEach(d=>{const el = document.createElement('div'); el.className='digit'; el.textContent=d; r.appendChild(el);});
      });
    }

    populateStrips();

    // utilities
    function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}
    function pad3(n){return String(n).padStart(3,'0')}

    // animate lights blink
    let lightTimer = 0;
    function animateLights(t){
      lightTimer++;
      lights.forEach((l,i)=>{
        if((lightTimer + i*3) % 30 < 8) l.classList.add('on'); else l.classList.remove('on');
      });
      requestAnimationFrame(animateLights);
    }
    requestAnimationFrame(animateLights);

    // sound using WebAudio (improved slot-like clicks + musical ding)
    let audioCtx = null;
    let masterGain = null;
    function getAudioCtx(){ 
      if(!audioCtx){ 
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        masterGain = audioCtx.createGain();
        masterGain.gain.setValueAtTime(1, audioCtx.currentTime);
        masterGain.connect(audioCtx.destination);
      }
      return audioCtx 
    }

    function playTone(freq, opts = {}){
      const ctx = getAudioCtx();
      if(!masterGain && ctx){ masterGain = ctx.createGain(); masterGain.gain.setValueAtTime(1, ctx.currentTime); masterGain.connect(ctx.destination); }
      const {time = 0, duration = 0.18, type = 'sine', gain = 0.04} = opts; // quieter default
      const o = ctx.createOscillator(); const g = ctx.createGain();
      o.type = type; o.frequency.setValueAtTime(freq, ctx.currentTime + time);
      g.gain.setValueAtTime(0.0001, ctx.currentTime + time);
      o.connect(g); g.connect(masterGain || ctx.destination);
      g.gain.exponentialRampToValueAtTime(gain, ctx.currentTime + time + 0.005);
      o.start(ctx.currentTime + time);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + time + duration);
      o.stop(ctx.currentTime + time + duration + 0.02);
    }

    // short, percussive 'Îî±Îî±' clicks used during reel spin (crisper, softer)
    function tickSound(){
      const base = 650 + Math.random()*400;
      playTone(base, {duration:0.036, type:'square', gain:0.028});
      playTone(base * 1.6, {time:0.006, duration:0.036, type:'sine', gain:0.014});
    }

    // musical ding for final result (soft arpeggio)
    function dingSound(){
      playTone(680, {duration:0.26, type:'triangle', gain:0.08});
      playTone(920, {time:0.12, duration:0.32, type:'sine', gain:0.06});
      playTone(1180, {time:0.26, duration:0.36, type:'sine', gain:0.05});
    }

    // confetti paper-rustle sound: many short high-passed noise bursts
    function popSound(count = 6){
      const ctx = getAudioCtx();
      const sr = ctx.sampleRate;
      // short noise buffer (60ms)
      const len = Math.floor(sr * 0.06);
      const buf = ctx.createBuffer(1, len, sr);
      const data = buf.getChannelData(0);
      for(let i=0;i<len;i++){
        // decreasing amplitude to make it 'papery'
        data[i] = (Math.random()*2 - 1) * (1 - i/len) * 0.9;
      }
      for(let i=0;i<count;i++){
        const src = ctx.createBufferSource(); src.buffer = buf;
        const hp = ctx.createBiquadFilter(); hp.type = 'highpass'; hp.frequency.setValueAtTime(900 + Math.random()*800, ctx.currentTime);
        const g = ctx.createGain();
        src.connect(hp); hp.connect(g); g.connect(ctx.destination);
        const t = i * 0.035;
        // short envelope
        g.gain.setValueAtTime(0.0001, ctx.currentTime + t);
        g.gain.linearRampToValueAtTime(0.06 * (0.6 + Math.random()*0.6), ctx.currentTime + t + 0.006);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + t + 0.18);
        src.start(ctx.currentTime + t);
        src.stop(ctx.currentTime + t + 0.2);
      }
    }

    // special celebration for max score (100)
    function specialMax(){
      // louder multi-note arpeggio
      playTone(760, {duration:0.26, type:'triangle', gain:0.12});
      playTone(980, {time:0.09, duration:0.32, type:'sine', gain:0.1});
      playTone(1280, {time:0.18, duration:0.36, type:'sine', gain:0.08});
      // big fancy gold confetti (no banner)
      const rect = finalDisplay.getBoundingClientRect();
      spawnConfetti(rect.left + rect.width/2, rect.top + rect.height/2, 260, ['#ffd166','#ffb703','#fff8d0','#ffd1a9','#06d6a0','#ff7b7b']);
      // additional heavier pops
      popSound(10);
      // pop/scale animation on finalDisplay
      try{ finalDisplay.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.14)' }, { transform: 'scale(1)' }], { duration: 900, easing: 'cubic-bezier(.2,.9,.2,1)' }); }catch(e){}
    }

    // special consolation for min score (1)
    function specialMin(){
      // soft low-tone
      playTone(220, {duration:0.28, type:'sine', gain:0.06});
      playTone(320, {time:0.08, duration:0.22, type:'sine', gain:0.04});
      // cool confetti (smaller, tasteful)
      const rect = finalDisplay.getBoundingClientRect();
      spawnConfetti(rect.left + rect.width/2, rect.top + rect.height/2, 64, ['#9ad3ff','#6fb6ff','#8be9d5']);
      popSound(3);
      // subtle shake
      try{ finalDisplay.animate([{ transform: 'translateX(0)' }, { transform: 'translateX(-6px)' }, { transform: 'translateX(6px)' }, { transform: 'translateX(0)' }], { duration: 650, iterations:1 }); }catch(e){}
    }

    // confetti particle (enhanced: supports palette and varied sizes/shapes)
    function spawnConfetti(x,y,amount=40,palette){
      const baseColors = ['#ffd166','#06d6a0','#118ab2','#ef476f','#ffb703','#fff8d0','#ff7b7b'];
      const colors = Array.isArray(palette) && palette.length ? palette : baseColors;
      for(let i=0;i<amount;i++){
        const sizeFactor = Math.random();
        const w = 6 + Math.random()*18 * (0.6 + sizeFactor);
        const h = 6 + Math.random()*18 * (0.6 + (1-sizeFactor));
        const shape = Math.random() < 0.2 ? 'circle' : 'rect';
        particles.push({
          x: x + (Math.random()-0.5) * 60,
          y: y + (Math.random()-0.5) * 30,
          vx: (Math.random()-0.5) * 10,
          vy: Math.random()*-12 - 2,
          rot: Math.random()*360,
          vr: Math.random()*18-9,
          w: w,
          h: h,
          color: colors[Math.floor(Math.random()*colors.length)],
          life: 60 + Math.floor(Math.random()*80),
          shape: shape,
          alpha: 0.9 - Math.random()*0.5
        });
      }
    }

    function renderConfetti(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.vy += 0.32 + Math.abs(Math.sin((p.x+p.y)/100))*0.08; p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.life--;
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180);
        ctx.globalAlpha = p.alpha || 1;
        if(p.shape === 'circle'){
          ctx.beginPath(); ctx.fillStyle = p.color; ctx.arc(0,0, Math.max(2, Math.min(p.w,p.h)/2), 0, Math.PI*2); ctx.fill();
        } else {
          // rectangle with slight rounding
          ctx.fillStyle = p.color; const rx = Math.max(2, p.w*0.12);
          roundRect(ctx, -p.w/2, -p.h/2, p.w, p.h, rx);
        }
        ctx.globalAlpha = 1;
        ctx.restore();
        if(p.life<=0 || p.y>canvas.height+100) particles.splice(i,1);
      }
      requestAnimationFrame(renderConfetti);
    }

    // helper: draw rounded rect
    function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); ctx.fill(); }
    requestAnimationFrame(renderConfetti);

    // main spin function
    let spinning = false;
    async function spin(){
      if(spinning) return; spinning=true; spinBtn.disabled=true; spinBtn.setAttribute('aria-pressed','true');
      // resume audio context if suspended (user gesture requirement)
      const ctx = getAudioCtx();
      if(ctx.state === 'suspended') await ctx.resume();

      // removed pulse animation to avoid visual popping

      // determine target number
      const target = randInt(MIN, MAX);
      const digits = pad3(target).split('').map(Number); // [h,t,o]

      // randomize spin durations for each reel
      const baseDur = 1500; // ms
      const delays = [randInt(0,120), randInt(140,260), randInt(260,420)];
      const durations = [baseDur+randInt(200,600), baseDur+randInt(600,1000), baseDur+randInt(1000,1600)];

      // animate each reel by translating its strip to land on target digit

      // Helper: animate a strip to show the target digit
      function animateReel(rIdx, endDigit, duration, startDelay){
        return new Promise((resolve)=>{
          const strip = reels[rIdx];
          // Each digit element height
          const sample = strip.querySelector('.digit');
          if(!sample){ resolve(); return; }
          const gapStr = getComputedStyle(strip).gap || '8px';
          const gap = parseFloat(gapStr) || 8;
          const dh = sample.getBoundingClientRect().height + gap; // include gap

          // Find index of the final target occurrence near the end for a smooth stop
          // We'll use the final cycle's position: cycles=12, digits per cycle=10
          const digitsPerCycle = 10;
          const cycles = 12;
          const targetIndex = cycles*digitsPerCycle + endDigit; // land on this element

          const finalY = -(targetIndex * dh) + (strip.parentElement.getBoundingClientRect().height/2 - dh/2);

          // start at random offset so it looks dynamic
          const startOffsetIndex = randInt(0, digitsPerCycle*3);
          const startY = -(startOffsetIndex * dh) + (strip.parentElement.getBoundingClientRect().height/2 - dh/2);
          strip.style.transition = 'none'; strip.style.transform = `translateY(${startY}px)`;

          // schedule percussive, dry taps synced to the reel transition (no reverb)
          // then transition to finalY
          setTimeout(()=>{
            strip.style.transition = `transform ${duration}ms cubic-bezier(.12,.9,.22,1)`;
            strip.style.transform = `translateY(${finalY}px)`;

            // schedule crisp, dry taps that align with the transition duration
            try{
              const ctx = getAudioCtx();
              const durSec = duration / 1000;
              const ticks = Math.max(4, Math.floor(durSec * 8));
              const interval = durSec / ticks;
              const startOffset = 0.02; // small offset from now
              const startTime = ctx.currentTime + startOffset;
              for(let k=0;k<ticks;k++){
                const t = startTime + k * interval;
                const f = 300 + Math.random() * 220; // low 'wood' tone
                playTone(f, {time: t - ctx.currentTime, duration:0.05, type:'triangle', gain:0.05});
                // small high click for attack
                playTone(f * 1.8, {time: t - ctx.currentTime + 0.004, duration:0.03, type:'sine', gain:0.02});
              }
              // final solid thud shortly before the end
              const finalThudTime = startTime + durSec - 0.05;
              const thudFreq = 160 + Math.random()*60;
              playTone(thudFreq, {time: finalThudTime - ctx.currentTime, duration:0.08, type:'sine', gain:0.06});

              // schedule mobile haptic vibration (if supported) to align with final thud
              if(navigator.vibrate){
                const now = ctx.currentTime;
                const delayMs = Math.max(0, Math.floor((finalThudTime - now) * 1000));
                setTimeout(()=>{ try{ navigator.vibrate(20); }catch(e){} }, delayMs);
              }
            }catch(e){}

            // resolve after animation ends
            setTimeout(()=>{ strip.style.transition='none'; resolve(); }, duration+40);
          }, startDelay);
        });
      }

      // run reels in parallel, with staggered delays
      await Promise.all([
        animateReel(0, digits[0], durations[0], delays[0]),
        animateReel(1, digits[1], durations[1], delays[1]),
        animateReel(2, digits[2], durations[2], delays[2])
      ]);

      // combine digits to number
      const shown = Number(digits.join(''));
      // If result is 000 -> treat as 100, if >100 cap at 100. This makes distribution slightly non-uniform but fun.
      const finalScore = shown === 0 ? 100 : Math.min(shown,100);

        // apply color class based on score range
        function applyScoreColor(score){
          finalDisplay.classList.remove('score-low','score-mid','score-high');
          if(typeof score !== 'number' || isNaN(score)) return;
          if(score <= 30) finalDisplay.classList.add('score-low');
          else if(score <= 70) finalDisplay.classList.add('score-mid');
          else finalDisplay.classList.add('score-high');
        }

        finalDisplay.textContent = finalScore;
        applyScoreColor(finalScore);
      finalDisplay.style.opacity=0; finalDisplay.style.transform='translateY(6px)';
      setTimeout(()=>{finalDisplay.style.transition='all 420ms cubic-bezier(.2,.9,.2,1)'; finalDisplay.style.opacity=1; finalDisplay.style.transform='translateY(0)';},40);

      // celebratory sound + confetti; extra special-case handling for min/max
      const rect = finalDisplay.getBoundingClientRect();
      if(finalScore === 100){
        // special max
        specialMax();
      } else if(finalScore === 1){
        // special min
        specialMin();
      } else {
        dingSound();
        spawnConfetti(rect.left + rect.width/2, rect.top + rect.height/2, 80);
        popSound(4);
      }

      // small glow pulse (kept for all cases)
      finalDisplay.animate([{boxShadow:'0 0 0 rgba(0,0,0,0)'},{boxShadow: '0 0 36px rgba(6,214,160,0.14)'}],{duration:900,iterations:1});

      // update UI
      spinning=false; spinBtn.disabled=false; spinBtn.setAttribute('aria-pressed','false');
    }

    // wire button
    spinBtn.addEventListener('click', ()=>{ if(!spinning) spin(); });

    // snapshot button
    const snapBtn = document.getElementById('snapBtn');

    // snapshot: render a small number card and offer download or share
    function snapshotNumber(){
      const txt = (finalDisplay.textContent || '').trim() || '-';
      // create canvas sized for a card
      const w = 720, h = 480;
      const c = document.createElement('canvas'); c.width = w; c.height = h;
      const cctx = c.getContext('2d');
      // background gradient
      const g = cctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0,'#041826'); g.addColorStop(1,'#05222b');
      cctx.fillStyle = g; cctx.fillRect(0,0,w,h);
      // soft rounded card overlay
      cctx.fillStyle = 'rgba(255,255,255,0.02)'; cctx.fillRect(24,24,w-48,h-48);
      // big number
      cctx.fillStyle = '#06d6a0'; cctx.font = 'bold 160px system-ui, sans-serif'; cctx.textAlign='center'; cctx.textBaseline='middle';
      cctx.fillText(txt, w/2, h/2 - 10);
      // hint
      cctx.fillStyle = '#9fb2d8'; cctx.font = '20px system-ui, sans-serif'; cctx.fillText('ÎÇ¥Ïùº ÎÇ¥ ÏãúÌóòÏ†êÏàòÎäî?', w/2, h - 60);

      // convert to blob and share/download
      c.toBlob(async (blob)=>{
        if(!blob) return;
        const file = new File([blob], 'score.png', {type:'image/png'});
        // try Web Share Level 2
        try{
          if(navigator.canShare && navigator.canShare({files:[file]})){
            await navigator.share({files:[file], title:'ÏãúÌóòÏ†êÏàò', text:`ÎÇ¥Ïùº ÎÇ¥ ÏãúÌóòÏ†êÏàò: ${txt}`});
            return;
          }
        }catch(e){}
        // fallback: download
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'score.png'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      }, 'image/png');
    }

    if(snapBtn){ snapBtn.addEventListener('click', snapshotNumber); }

    // share / copy result
    // share logic removed per user request

    // keyboard support (space)
    window.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ e.preventDefault(); spinBtn.click(); } });

    // initialize display
    finalDisplay.textContent='‚Äî';

    // idle wobble removed for cleaner, stable numeric display

  </script>
</body>
</html>
